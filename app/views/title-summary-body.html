{% extends "layout.html" %}
{% block page_title %}New news article{% endblock %}

{% block content %}

{% if referrer() == 'document-type' or referrer() == 'format' %}
  {% set editing = false %}
{% else %}
  {% set editing = true %}
{% endif %}

{% if data[prefix + 'format'] == 'Medical safety alert' %}
  {% set slugPrefix = 'drug-device-alerts' %}
{% elseif data[prefix + 'format'] == 'Drug safety update' %}
  {% set slugPrefix = 'drug-safety-update' %}
{% endif %}

{% set attachment_count = data[prefix + 'attachment-count'] | int %}

<a href="{{ urlPrefix }}{% if editing %}/document-tasks{% else %}/document-type{% endif %}" class="govuk-c-back-link">Back</a>
<main role="main" class="govuk-o-main-wrapper">
  <form action="{{ urlPrefix }}/document-tasks" method="post" class="form" data-module="slug-from-title" data-prefix= "{{ slugPrefix }}">
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <h1 class="form-title govuk-heading-xl">
          {% if editing and data[prefix + 'title'] %}
            <span class="govuk-caption-xl">{{ data[prefix + 'format'] }}</span>
            {{ data[prefix + 'title'] }}
          {% else %}
            {% if data[prefix + 'document-type'] %}
              <span class="govuk-caption-xl">{{ data[prefix + 'format'] }}</span>
              Create {{ data[prefix + 'document-type'] | lower }}
            {% else %}
              Create {{ data[prefix + 'format'] | lower }}
            {% endif %}
          {% endif %}
        </h1>
        {% if data[prefix + 'document-type'] == 'News story' %}
          <h2 class="govuk-heading-m">Guidance for writing a {{ data[prefix + 'document-type'] | lower }}</h2>
          <p class="govuk-body">
            News written exclusively for GOV.UK which users need, can act on, and can’t get from other sources. News stories should be self-contained and can be removed from the site without affecting other content.
          </p>
          <details class="govuk-c-details">
            <summary class="govuk-c-details__summary"><span class="govuk-c-details__summary-text">Keep reading</span></summary>
            <div class="govuk-c-border govuk-c-border--left-narrow">
              <ul class="recommendations">
                <li>Don’t duplicate news published by another department - collaborate if needed.</li>
                <li>Don’t publish guidance in new stories - it can go out of date and won’t be found by users.</li>
                <li>Don’t publish news just to announce other GOV.UK content - it confuses users and search results.</li>
              </ul>
              <p class="govuk-body">Read the <a href="https://www.gov.uk/guidance/content-design/content-types#news-story">news story guidance</a> in full.</p>
            </div>
          </details>
        {% endif %}
      </div>
    </div>

    <div class="govuk-o-grid" data-module="live-content-check">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <div class="govuk-!-mb-r6 is-input">
          <label class="govuk-c-label" for="title">
            Title
          </label>
          <input required type="text" name="{{ prefix }}title" autocomplete="off" class="js-check-content govuk-c-input" id="title" data-target="title-checks" value="{% if editing %}{{data[prefix + 'title']}}{% endif %}">
          <span class="govuk-c-label__hint govuk-body" style="margin-top: -25px">65 characters or fewer</span>
        </div>
      </div>
      <div class="govuk-o-grid__item govuk-o-grid__item--one-third">
        <div class="js-contextual-guidance contextual-guidance" style="display: none">
          <div id="title-checks"></div>
          <h3 class="govuk-heading-s govuk-!-mb-r1">Writing guidance</h3>
          <ul class="govuk-list">
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/content-design/writing-for-gov-uk#plain-english">Using plain English</a></li>
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/style-guide">The style guide</a></li>
            <li><a class="govuk-link" href="#">Words to avoid</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="govuk-o-grid js-slug">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <div class="govuk-!-mb-r6 panel panel-border-wide">
          <h3 class="govuk-heading-s govuk-!-mb-r1 govuk-!-m-r0">The web address for this content will look like:</h3>
          <span class="govuk-body empty">
            You haven’t entered a title yet.
          </span>
          <span class="govuk-body js-slug-parent">
            https://www.gov.uk/<span class="js-dynamic-slug">government/this-is-the-title</span>
          </span>
        </div>
      </div>
    </div>

    <div class="govuk-o-grid" data-module="live-content-check">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <div class="govuk-!-mb-r6 is-textarea">
          <label class="govuk-c-label" for="summary">
            Summary
          </label>
          <textarea name="{{ prefix }}summary" class="govuk-c-textarea js-check-content" data-target="summary-checks" id="summary" rows="2">{% if editing %}{{data[prefix + 'summary']}}{% endif %}</textarea>
        </div>
      </div>
      <div class="govuk-o-grid__item govuk-o-grid__item--one-third">
        <div class="js-contextual-guidance contextual-guidance" style="display: none">
          <div id="summary-checks"></div>
          <h3 class="govuk-heading-s govuk-!-mb-r1">Writing guidance</h3>
          <ul class="govuk-list">
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/content-design/writing-for-gov-uk#plain-english">Using plain English</a></li>
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/style-guide">The style guide</a></li>
            <li><a class="govuk-link" href="#">Words to avoid</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="govuk-o-grid body-guidance" data-module="live-content-check">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <div class="govuk-!-mb-r6 is-textarea">
          <label class="govuk-c-label" for="body" id="body-label">
            Body
          </label>
          <div class="inserts">
            <a href="#">Preview markdown</a>
            {% if attachment_count > 0 %}
            <a href="#" id="openModal">Insert attachment</a>
            <a href="#" style="margin-left: 20px">Insert image</a>
            {% endif %}
          </div>
          <textarea name="{{ prefix }}body" class="govuk-c-textarea js-check-content" data-target="body-checks" name="{{ prefix }}textarea" id="body" rows="40">{% if editing %}{{data[prefix + 'body']}}{% endif %}</textarea>
        </div>
      </div>
      <div class="govuk-o-grid__item govuk-o-grid__item--one-third">
        <div class="js-contextual-guidance contextual-guidance" style="display: none">
          <div id="body-checks"></div>
          <h3 class="govuk-heading-s govuk-!-mb-r1">Writing guidance</h3>
          <ul class="govuk-list">
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/content-design/writing-for-gov-uk#plain-english">Using plain English</a></li>
            <li><a class="govuk-link" href="https://www.gov.uk/guidance/style-guide">The style guide</a></li>
            <li><a class="govuk-link" href="#">Words to avoid</a></li>
          </ul>
          <h2 class="govuk-heading-s govuk-!-mb-r1">Markdown guidance</h2>
          <p class="govuk-body">For details, read the guide to using Markdown</p>
          <ul class="govuk-list" data-module="toggle">
            <li>
              <a class="govuk-link" href="#markdown-headings" data-controls="markdown-headings" data-expanded="false">Headings</a>
              <div style="display: none" id="markdown-headings">Content</div>
            </li>
            <li>
              <a class="govuk-link" href="#markdown-links" data-controls="markdown-links" data-expanded="false">Links</a>
              <div style="display: none" id="markdown-links">Content</div>
            </li>
            <li>
              <a class="govuk-link" href="#markdown-bullets" data-controls="markdown-bullets" data-expanded="false">Bullets</a>
              <div style="display: none" id="markdown-bullets">Content</div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="govuk-!-mb-r6">
      <input type="submit" class="govuk-c-button" value="Save">
    </div>
    <!-- <input type="submit" class="button add-left-margin" formaction="?saved" value="Save and continue editing"> -->
    {% if editing %}
    <div class="govuk-!-mb-r6 govuk-body">
      <a href="{{ urlPrefix }}/document-tasks" class="button button-link">Discard changes</a>
    </div>
    {% endif %}
  </form>

  <dialog id="js-modal-dialog" class="modal-dialog dialog" role="dialog" aria-live="polite" aria-labelledby="dialog-title" aria-describedby="at-timer" data-module="attachment-insert">
    <div class="modal-dialog__inner js-select-form">
      <h1 id="dialog-title" class="heading-large govuk-!-mb-r6">
        Insert attachment
      </h1>
      <div class="modal-dialog__inner__text govuk-!-mb-r2">
        <h2 class="govuk-heading-m govuk-!-mb-r2">Select an attachment</h2>
        {% include "includes/attachment-list.html" %}

        <h2 class="govuk-heading-m govuk-!-mb-r2">Or insert a new one</h2>
      </div>
      <div class="modal-dialog__inner__block">
        <a href="{{ urlPrefix }}/attachment" class="govuk-c-button dialog-button modal-dialog__inner__button js-upload-attachment">Insert new attachment</a>

        <p class="govuk-body govuk-!-mb-r0">
          <a href="{{ urlPrefix }}/" class="js-dialog-close">Cancel</a>
        </p>
      </div>
    </div>
    <div class="modal-dialog__inner js-upload-form" style="display: none">
      <h1 id="dialog-title" class="heading-large govuk-!-mb-r6">
        Insert a new attachment
      </h1>
      <div class="modal-dialog__inner__text">
        <div class="is-input">
          <label class="govuk-c-label govuk-c-label--bold" for="attachment-title">
            Attachment title
            <span class="govuk-c-label__hint">Use the official title of the document</span>
          </label>
          <input required type="text" name="{{ prefix }}{{ attachment_id }}-attachment-title" class="js-check-content govuk-c-input govuk-!-mb-r3" id="attachment-title" data-target="attachment-title-checks" value="{% if editing %}{{data[prefix + attachment_id + '-attachment-title']}}{% endif %}">
        </div>

        <label class="govuk-c-label govuk-c-label--bold" for="attachment-file">
          File
        </label>
        <input type="file" name="{{ prefix }}attachment-file" class="govuk-c-file-upload govuk-!-mb-r0">
      </div>
      <div class="modal-dialog__inner__block">
        <a href="{{ urlPrefix }}/attachment" class="govuk-c-button  govuk-!-mb-r6 dialog-button modal-dialog__inner__button js-edge ">Insert attachment</a>

        <p class="govuk-body govuk-!-mb-r0">
          <a href="{{ urlPrefix }}/" class="js-upload-close">Cancel</a>
        </p>
      </div>
    </div>
  </dialog>
</main>
{% endblock %}
