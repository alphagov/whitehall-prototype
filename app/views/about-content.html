{% extends "layout.html" %}
{% block page_title %}About content{% endblock %}

{% block content %}

<a href="/document-tasks" class="govuk-c-back-link">Back</a>
<main role="main" class="govuk-o-main-wrapper">
  <form action="/document-tasks" method="post" class="form about" data-module="slug-from-title">
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <h1 class="form-title govuk-heading-xl">
          About this content
        </h1>
      </div>
    </div>

    {% if data['format'] == 'Drug safety update' %}
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <label class="govuk-c-label" for="therapeutic-area">Therapeutic area</label>
        <input type="text" name="therapeutic-area" class="govuk-c-input govuk-!-mb-r0" id="therapeutic-area" value="{{data['therapeutic-area']}}">
        <div class="govuk-!-mt-r2 govuk-!-mb-r1">
          <a href="#" class="button button-link govuk-body">Add another therapeutic area</a>
        </div>
      </div>
    </div>
    {% endif %}

    {% if data['format'] == 'Medical safety alert' %}
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <label class="govuk-c-label" for="medical-specialism">Medical specialism</label>
        <input type="text" name="medical-specialism" class="govuk-c-input govuk-!-mb-r0" id="medical-specialism" value="{{data['medical-specialism']}}">
        <div class="govuk-!-mt-r2 govuk-!-mb-r1">
            <a href="#" class="button button-link govuk-body">Add another medical specialism</a>
        </div>


        <div style="margin-bottom: -20px">
        {{ govukDateInput({
          fieldset: {
            legendText: 'Issue date',
            legendHintText: 'For example, 31 3 2017'
          },
          id: 'issue-date',
          name: 'issue-date',
          items:[
            {
              name: 'day',
              value: data['issue-date-day']
            },
            {
              name: 'month',
              value: data['issue-date-month']
            },
            {
              name: 'year',
              value: data['issue-date-year']
            }
          ]
          })
        }}
        </div>
      </div>
    </div>
    {% endif %}

    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        {% if not data['specialist'] %}<h2 class="govuk-heading-l">Monitoring</h2>{% endif %}
        <div class="govuk-c-radios">
          <fieldset class="govuk-c-fieldset">
            <legend class="govuk-c-fieldset__legend">
              Review frequency
            </legend>
            {% set fields = [
                {
                  name: 'Never, this is a one-off',
                  more: 'Because this content won\'t be reviewed, it will be downgraded as more recent content is published on GOV.UK'
                },
                {
                  name: 'Quarterly',
                  more: 'You will be reminded to review this content the quarter after it was published.'
                },
                {
                  name: 'Yearly',
                  more: 'You will be reminded to review this content the year it was published.'
                },
                {
                  name: 'A custom date',
                  more: '<label class="govuk-c-label" for="review-frequency-other">Enter a date to get a reminder to review</label>
                  <span class="govuk-c-label__hint govuk-body">For example, 5 June 2019</span>'
                }
              ]
            %}
            {% for field in fields %}
              <div class="govuk-c-radios__item" data-target="radio-part-{{ loop.index }}-extra">
                <input id="radio-part-{{ loop.index }}" type="radio" name="review-frequency" value="{{ field.name }}" class="govuk-c-radios__input" {{ checked("review-frequency", field.name) }}>
                <label for="radio-part-{{ loop.index }}" class="govuk-c-label govuk-c-radios__label">
                  {{ field.name }}
                  {% if field.more %}
                  <div class="panel panel-border-wide js-hidden govuk-!-mt-r4" id="radio-part-{{ loop.index }}-extra">
                    {{ field.more | safe }}
                    {% if field.name == 'A custom date' %}
                      <input type="text" name="review-frequency-other" class="govuk-c-input govuk-!-width-one-half" id="review-frequency-other" value="{{ data['review-frequency-other']}}">
                    {% endif %}
                  </div>
                  {% endif %}
                </label>
              </div>
            {% endfor %}
          </fieldset>
        </div>
        <div class="govuk-!-mb-r6 is-input">
          <label class="govuk-c-label" for="expected-audience">Expected audience</label>
          <input type="text" name="expected-audience" class="govuk-c-input govuk-!-width-one-quarter" id="expected-audience" value="{{data['expected-audience']}}"> <span class="inline govuk-body">views per month</span>

          {% if not data['specialist'] %}
            <label class="govuk-c-label" for="expert">Subject matter expert</label>
            <input type="text" name="expert" class="govuk-c-input" id="expert" value="{{data['expert']}}">
          {% endif %}
        </div>
      </div>
    </div>

    {% if not data['specialist'] %}
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <h2 class="govuk-heading-l">Tag on GOV.UK</h2>
        <p class="govuk-body">Tags help position this content in <a href="">GOV.UK</a>, they make it easier to find by relating it to existing content that is similar to it.</p>
      </div>
    </div>

    <div class="govuk-o-grid govuk-!-mb-r7" data-module="select-tags">
      {% if data['tag-count'] %}
        {% set tag_count = (data['tag-count'] | int) %}
      {% else %}
        {% set tag_count = 0 %}
      {% endif %}
      <input type="hidden" name="tag-count" value="{{ tag_count }}" class="js-tag-count">
      <div class="govuk-o-grid__item govuk-o-grid__item--full">
        <div class="js-none-selected" {% if (tag_count > 0) %}style="display: none"{% endif %}>
          <h3 class="govuk-heading-s">Selected tags</h3>
          <p class="govuk-body empty govuk-!-mb-r6">You haven't selected any tags yet.</p>
        </div>
        <table class="govuk-c-table js-selected-tags-table" {% if (tag_count == 0) %}style="display: none"{% endif %}>
          <caption class="govuk-c-table__caption">Selected tags</caption>
          <tbody class="govuk-c-table__body">
            <tr class="govuk-c-table__row js-selected-tag-row" style="display: none">
              <td class="govuk-c-table__cell tag js-tag"></td>
              <td class="govuk-c-table__cell govuk-c-table__cell--numeric">
                <a href="#">View in GOV.UK</a>
                <input type="hidden" value="" name="selected-tag">
              </td>
              <td class="govuk-c-table__cell govuk-c-table__cell--numeric"><a href="" class="js-remove-tag">Remove tag</a></td>
            </tr>
            {% for i in range(0, tag_count) %}
              <tr class="govuk-c-table__row">
                <td class="govuk-c-table__cell tag">{{ data['selected-tag-' + (i + 1)] }}</td>
                <td class="govuk-c-table__cell govuk-c-table__cell--numeric">
                  <a href="#">View in GOV.UK</a>
                  <input type="hidden" value="{{ data['selected-tag-' + (i + 1)] }}" name="selected-tag-{{ (i + 1) }}">
                </td>
                <td class="govuk-c-table__cell govuk-c-table__cell--numeric"><a href="" class="js-remove-tag">Remove tag</a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

        <table class="govuk-c-table js-suggested-tags-table">
          <caption class="govuk-c-table__caption">Suggested tags</caption>
          <tbody class="govuk-c-table__body">
            {% set suggested_tags = [
                {
                  name: 'Transport > Rail > HS2 > HS2 stakeholder and community engagement',
                  title_contains: 'hs2'
                },
                {
                  name: 'Transport > Rail > HS2 > HS2 phase one',
                  title_contains: 'hs2'
                },
                {
                  name: 'Transport > Driving and road transport > Autonomous road vehicles',
                  title_contains: 'automated'
                },
                {
                  name: 'Transport > Freight and cargo > Transport of dangerous goods > Safe transport of dangerous goods > Safe transport of dangerous goods by road',
                  title_contains: 'dangerous'
                },
                {
                  name: 'Transport > Freight and cargo > Transport of dangerous goods > Dangerous goods classification',
                  title_contains: 'dangerous'
                },
                {
                  name: 'Transport > Road infrastructure > Road improvement and investment',
                  title_contains: 'highways'
                },
                {
                  name: 'Transport > Road infrastructure > Road maintenance',
                  title_contains: 'highways'
                }
              ]
            %}

            {% for tag in suggested_tags %}
              {% if tag.title_contains in (data['title'] | lower) %}
                <tr class="govuk-c-table__row">
                  <td class="govuk-c-table__cell tag">{{ tag.name }}</td>
                  <td class="govuk-c-table__cell govuk-c-table__cell--numeric"><a href="#">View in GOV.UK</a></td>
                  <td class="govuk-c-table__cell govuk-c-table__cell--numeric"><a href="" class="js-select-tag">Select tag</a></td>
                </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <label class="govuk-c-label" for="tag-search">Search for a tag</label>
        <select id="tag-search" name="tag-search">
          {% include "includes/topics-select-options.html" %}
        </select>
      </div>
      <div class="govuk-o-grid__item govuk-o-grid__item--one-third govuk-!-mt-r7">
        <a href="" class="inline button button-link govuk-body js-add-tag">Select tag</a>
      </div>
    </div>
    {% endif %}

    {% if not data['specialist'] %}
    <div class="govuk-o-grid">
      <div class="govuk-o-grid__item govuk-o-grid__item--two-thirds">
        <div class="govuk-!-mb-r6 is-input">
          <h2 class="govuk-heading-l">Associations</h2>
          <label class="govuk-c-label" for="lead-organisation">
            Lead organisation
          </label>
          <select id="lead-organisation" name="lead-organisation">
            {% include "includes/organisation-select-options.html" %}
          </select>
          <div class="govuk-!-mt-r2 govuk-!-mb-r1">
            <a href="#" class="button button-link govuk-body">Add another leading organisation</a>
          </div>
          <label class="govuk-c-label" for="supporting-organisation">Supporting organisation</label>
          <select id="supporting-organisation" name="supporting-organisation">
            {% include "includes/organisation-select-options.html" %}
          </select>
          <div class="govuk-!-mt-r2 govuk-!-mb-r1">
            <a href="#" class="button button-link govuk-body">Add another supporting organisation</a>
          </div>

          <label class="govuk-c-label" for="minister">Minister</label>
          <input type="text" name="minister" class="govuk-c-input" id="minister" value="{{data['minister']}}">

          <label class="govuk-c-label" for="topical-event">Topical events</label>
          <input type="text" name="topical-event" class="govuk-c-input" id="topical-event" value="{{data['topical-event']}}">

          <label class="govuk-c-label" for="world-locations">World locations</label>
          <input type="text" name="world-location" class="govuk-c-input" id="world-locations" value="{{data['world-location']}}">

        </div>
      </div>
    </div>
    {% endif %}
    <div class="govuk-!-mb-r6">
      <input type="submit" class="govuk-c-button" value="Save">
    </div>

    <div class="govuk-!-mb-r6">
      <a href="/document-tasks" class="button button-link govuk-body">Discard changes</a>
    </div>
  </form>
</main>
{% endblock %}

{% block page_scripts %}
<script>
  $('#lead-organisation').val('{{ data['lead-organisation'] }}');
  $('#supporting-organisation').val('{{ data['supporting-organisation'] }}');

  govukGovernmentOrganisationsAutocomplete({
    selectElement: document.getElementById('lead-organisation'),
    showAllValues: true,
    autoselect: false,
    minLength: 2,
    defaultValue: '{{ data['lead-organisation'] }}'
  })

  govukGovernmentOrganisationsAutocomplete({
    selectElement: document.getElementById('supporting-organisation'),
    showAllValues: true,
    autoselect: false,
    minLength: 2,
    defaultValue: '{{ data['supporting-organisation'] }}'
  })

  accessibleAutocomplete.enhanceSelectElement({
    selectElement: document.getElementById('tag-search'),
    id: 'tag-search',
    showAllValues: true,
    minLength: 2,
    defaultValue: ''
  })
</script>
{% endblock %}
